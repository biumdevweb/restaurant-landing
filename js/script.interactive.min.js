const menuItems=document.querySelectorAll(".menu-item"),formGroups=document.querySelectorAll(".form-group"),submitBtn=document.querySelector(".submit-btn"),formMessage=document.getElementById("formMessage"),reservationForm=document.getElementById("reservationForm");function validateField(e,t){const n=t.value.trim(),o=t.type;let s=!1;if(!n)return e.classList.add("invalid"),e.classList.remove("valid"),!1;switch(o){case"email":s=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n);break;case"tel":s=/^[\d\s\-\+\(\)]+$/.test(n)&&n.replace(/\D/g,"").length>=8;break;case"date":const e=new Date(n),t=new Date;t.setHours(0,0,0,0),s=e>=t;break;default:s=n.length>0}return s?(e.classList.add("valid"),e.classList.remove("invalid")):(e.classList.add("invalid"),e.classList.remove("valid")),s}function showFormMessage(e,t){formMessage.textContent=e,formMessage.className=`form-message ${t}`,formMessage.style.display="block",setTimeout(()=>{formMessage.classList.add("show")},10),setTimeout(()=>{formMessage.classList.remove("show"),setTimeout(()=>{formMessage.style.display="none"},300)},5e3)}function showAdvancedConfirmation(){const e=document.createElement("div");e.className="reservation-confirmation";const t=document.getElementById("name").value,n=document.getElementById("date").value,o=document.getElementById("time").value,s=document.getElementById("guests").value,a=new Date(n).toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric"});e.innerHTML=`\n    <div class="confirmation-content">\n      <div class="confirmation-header">\n        <div class="confirmation-icon">\n          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\n            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>\n          </svg>\n        </div>\n        <h2>Prenotazione Confermata!</h2>\n        <p>Grazie ${t}, la tua prenotazione Ã¨ stata confermata.</p>\n      </div>\n      <div class="confirmation-details">\n        <h3>Dettagli Prenotazione</h3>\n        <p><strong>Data:</strong> ${a}</p>\n        <p><strong>Ora:</strong> ${o}</p>\n        <p><strong>Ospiti:</strong> ${s}</p>\n        <p><strong>Email di conferma:</strong> Inviate a ${document.getElementById("email").value}</p>\n      </div>\n      <div class="confirmation-actions">\n        <button class="confirmation-btn primary">Chiudi</button>\n        <button class="confirmation-btn secondary">Modifica Prenotazione</button>\n      </div>\n    </div>\n  `,document.body.appendChild(e),setTimeout(()=>{e.classList.add("show")},10);const i=e.querySelector(".confirmation-btn.primary"),r=e.querySelector(".confirmation-btn.secondary");i.addEventListener("click",function(){closeConfirmationModal()}),r.addEventListener("click",function(){closeConfirmationModal(),reservationForm.scrollIntoView({behavior:"smooth"})}),e.addEventListener("click",function(t){t.target===e&&closeConfirmationModal()})}function closeConfirmationModal(){const e=document.querySelector(".reservation-confirmation");e&&(e.classList.remove("show"),setTimeout(()=>{document.body.removeChild(e)},300))}function setupParallax(){const e=document.querySelector(".hero"),t=document.querySelector(".hero-content");e&&t&&window.addEventListener("scroll",function(){const n=window.pageYOffset,o=-.5*n;n<e.offsetHeight&&(t.style.transform=`translate3d(0, ${o}px, 0)`)},{passive:!0})}function setupScrollAnimations(){const e=document.querySelectorAll(".menu-category, .testimonial-item, .gallery-slide, .about-text, .reservation-info, .contact-info"),t=new IntersectionObserver(e=>{e.forEach((e,t)=>{e.isIntersecting&&setTimeout(()=>{e.target.classList.add("animated")},100*t)})},{threshold:.1,rootMargin:"0px 0px -50px 0px"});e.forEach(e=>{e.style.opacity="0",t.observe(e)})}function setupAdvancedLazyLoading(){const e=document.querySelectorAll("img[data-src]");if("IntersectionObserver"in window){const t=new IntersectionObserver((e,n)=>{e.forEach(e=>{if(e.isIntersecting){const n=e.target;n.style.opacity="0",n.style.transition="opacity 0.5s ease",n.src=n.dataset.src,n.onload=function(){n.style.opacity="1"},n.classList.remove("lazy"),t.unobserve(n)}})});e.forEach(e=>{t.observe(e)})}}menuItems.forEach(e=>{e.addEventListener("click",function(t){if(!t.target.classList.contains("menu-action-btn"))if(menuItems.forEach(t=>{if(t!==e&&t.classList.contains("expanded")){t.classList.remove("expanded");const e=t.querySelector(".menu-item-actions");e&&e.remove()}}),this.classList.toggle("expanded"),this.classList.contains("expanded")){const e=document.createElement("div");e.className="menu-item-actions";const t=document.createElement("button");t.className="menu-action-btn",t.textContent="Aggiungi all'ordine";const n=document.createElement("button");n.className="menu-action-btn secondary",n.textContent="Dettagli",e.appendChild(t),e.appendChild(n),this.appendChild(e),setTimeout(()=>{e.style.opacity="1",e.style.transform="translateY(0)"},10)}else{const e=this.querySelector(".menu-item-actions");e&&e.remove()}})}),formGroups.forEach(e=>{const t=e.querySelector("input, textarea, select");t&&(t.addEventListener("blur",function(){validateField(e,t)}),t.addEventListener("input",function(){e.classList.contains("invalid")&&e.classList.remove("invalid")}))}),reservationForm&&reservationForm.addEventListener("submit",function(e){e.preventDefault();let t=!0;formGroups.forEach(e=>{const n=e.querySelector("input, textarea, select");if(n){validateField(e,n)||(t=!1)}}),t?(submitBtn.classList.add("loading"),submitBtn.disabled=!0,setTimeout(()=>{submitBtn.classList.remove("loading"),submitBtn.disabled=!1,showAdvancedConfirmation()},2e3)):showFormMessage("Per favore, compila tutti i campi obbligatori correttamente.","error")}),document.addEventListener("DOMContentLoaded",function(){setupParallax(),setupScrollAnimations(),setupAdvancedLazyLoading(),document.body.classList.add("loaded")});